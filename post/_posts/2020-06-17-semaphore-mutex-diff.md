---
layout: post
title: 세마포어(Semaphore)와 뮤텍스(Mutex)의 차이
noindex: true
comments: true
---
평소에 프로세스(Process)와 쓰레드(Thread)에 대해 공부하다보면 같이 나오는 개념들 중에
세마포어(Semaphore)와 뮤텍스(Mutex)에 대한 개념이 나온다.<br>
이름도 생소하고 항상 헷갈리는 개념들이기도 하다.<br>
그래서 이번에 이 둘의 개념과 차이를 정리하려고 한다.
---

### 세마포어(Semaphore) 정의
---
세마포어(Semaphore) 정의는 아래와 같다.<br>
>에츠허르 다익스트라가 제안한 교착 상태에 대한 해법으로 두개의 Atomic한 함수로 제어되는 정수 변수로 멀티프로그래밍 환경에서 공유자원에 대한 접근 제어를 하는 방식으로 
>1개의 공유되는 자원에 제한된 개수의 프로세스, 또는 스레드만 접근할 수 있도록 한다.<br>
>세마포어의 카운트는 1 이상이며 카운트를 조절하여 진입 가능한 프로세스/스레드 수를 조절할 수 있다. 
>세마포어 카운트가 항상 1인 것은 아니다.

정의만 봐서는 어떤 말인지 감이 오지 않는다.<br>
쉽게 말해서 세마포어는 다수의 프로세스 혹은 쓰레드가 실행됨에 있어서 **공유된 자원의 접근을 동시에 하지 못하도록 막는 기법**이라고 보면 된다.
그럼 왜 이러한 개념이 생겨났는지 아래의 예를 들어보자.

`int a = 10` 이라는 `공유된 변수`가 있다고 가정해보자.
a변수의 값을 1씩 증가시키는 프로세스A와 프로세스B가 실행된다면,
우리는 `a = 12`가 되었을 거라고 예상할 수 있다.
하지만 실제로 수행되는 형태는 아래와 같다.

```
a=10
1) 프로세스 A는 a의 값을 읽어온다. a=10
2) 프로세스 B는 a의 값을 읽어온다. a=10
3) 프로세스 A는 a의 값을 증가시킨다. a=11
4) 프로세스 B는 a의 값을 증가시킨다. a=11
a=11
```

결국 우리가 **예상한 결과값(12) 가 아닌 11**이 나오는 것을 볼 수 있다.<br>
이는 `공유된 변수`에 프로세스A와 프로세스B가 `동시에 접근`하였기 때문에 발생되는 문제이다.
이러한 문제를 다시말하면, **임계영역(Critical section)**에 진입하여 공유자원에 접근할때 문제가 발생했다고 말할 수 있다.<br>
그러면 우리가 예상한 결과값(12)가 나오게 하려면 어떻게 해야할까?<br>
이러한 생각에 나오게 된 개념이 바로 `세마포어(Semaphore)`이다.

#### 임계영역(Critical section) 란 ? <br>
> 서로 다른 두 프로세스, 혹은 스레드 등의 처리 단위가 같이 접근해서는 안 되는 공유 영역을 뜻한다.<br>
> 보호되지 않는 임계 구역에 두 처리 단위가 동시에 접근할 때 발생하는 문제를 '임계 구역 문제'라고 한다.<br>

### 세마포어(Semaphore) 동작 방식
---
세마포어(Semaphore)는 간단하게 말하면, `하나의 정수`라고 보면되며 `P연산`, `V연산`으로 이루어져있다고 보면 된다.
**P연산은 정수값(=세마포어(Semaphore))을 1감소 시키는 연산**이라고 보면 되고 **V연산은 정수값을 1증가 시키는 연산**이라고 보면 된다.
즉, 위에 이야기한 정수와 연산을 통해 프로세스(Process) 혹은 쓰레드(Thread)의 **동시 접근을 제어**한다.
위의 int a=10 일때의 예를 세마포어를 통해 어떻게 동시 접근을 제어하는지 살펴보자.

최초 S=1이라고 가정하자.<br>
프로세스(Process)는 S가 1 이상일때만 임계영역(Critical section)에 진입할 수 있다.

```
1) 프로세스A 수행
P(S) (S가 1감소되어 0)
//critical section start
프로세스A 실행(a=11)
//critical section end
V(S) (S가 1증가되어 1)
```
```
2) 프로세스B 수행
P(S) (S가 1감소되어 0)
//critical section start
프로세스B 실행(a=12)
//critical section end
V(S) (S가 1증가되어 1)
a=12
```
세마포어(Semaphore)를 통해 우리가 최초 기대했던 결과값(12)이 나오는 것을 확인할 수 있다.

그렇다면, S가 반드시 1이여야만하는지에 대한 의문이 생긴다.<br>
결과를 말하면 그렇지 않다. `S >= 0의 값`을 가질 수 있다.<br>
즉, 다시말해 S = 2이라면 임계영역(Critical section)에 접근할 수 있는 프로세스(Process) 혹은 쓰레드(Thread)가 2개라는 의미가 된다.
이 S가 가질 수 있는 값의 범위에 따라서 `세마포어(Semaphore)`에 이어 `뮤텍스(Mutex)`라는 개념이 생기게 된다.

#### 세마포어의 종류 <br>
> 세마포어(Semaphore)는 유지할 수 있는 값의 범위에 따라 이진 세마포어(Binary Semaphore)와 범용 세마포어(Counting Semaphore)로 구분된다.
> 초기값이 0 ~ N까지 가질수 있는 세마포어(Semaphore)를 카운팅 세마포어(Counting semaphore) 또는 범용 세마포어(general semaphore) 라고 한다.
> 이진 세마포어(Binary semaphore) 는 세마포어(Semaphore)의 초기 값이 0또는 1만 가질 수 있는 세마포어(Semaphore)다.

### 뮤텍스(Mutex) 정의
---
뮤텍스(Mutex) 정의는 아래와 같다.<br>
> MUTual EXclusion 으로 상호배제라고도 한다.<br>
> Critical Section을 가진 스레드들의 Runnig Time이 서로 겹치지 않게 각각 단독으로 실행되게 하는 기술이다.<br> 
> 다중 프로세스(Porcess) 혹은 쓰레드(Thread)들의 공유 자원에 대한 접근을 조율하기 위해 locking과 unlocking을 사용한다.<br>
> 뮤텍스(Mutex)의 상태는 lock과 unlock이 있다.

즉, 쉽게말해 다중 프로세스(Porcess) 혹은 쓰레드(Thread)들이 실행될 때 공유되는 자원에 대해 오로지 하나의 프로세스(Porcess) 혹은 쓰레드(Thread)만 
실행되도록 하며 이 후 실행되던 프로세스(Porcess) 혹은 쓰레드(Thread)가 끝나야만 다음 프로세스(Porcess) 혹은 쓰레드(Thread)가 수행될 수 있도록
하는 기법이다.

언뜻보면, 세마포어(Semaphore)와 뮤텍스(Mutext)가 비슷하게 느껴지고 심지어 같다고 생각되어지기까지 한다.

한번 이 둘의 차이를 비교해보자.

### 세마포어(Semaphore)와 뮤텍스(Mutex)의 차이
---
- 세마포어(Semaphore)는 뮤텍스(Mutex)가 될 수 있지만 뮤텍스는 세마포어가 될 수 없다.
- 뮤텍스(Mutex)는 이진 세마포어(Binary Semaphore)라고 볼 수 있다.
- 세마포어(Semaphore)는 소유할 수 없는 반면, 뮤텍스(Mutex)는 소유가 가능하며 소유주가 이에 대한 책임을 집는다.(뮤텍스(Mutex)의 경우 상태가 두개 뿐인 lock이므로 lock을 가질수 있다.)
- 뮤텍스(Mutex)의 경우 뮤텍스(Mutex)를 소유하고 있는 쓰레드(Thread)가 이 뮤텍스(Mutex)를 해제할 수 있다. 
- 하지만 세마포어(Semaphore)의 경우 이러한 세마포어(Semaphore)를 소유하지 않는 쓰레드(Thread)가 세마포어(Semaphore)를 해제 할 수 있다.
- 세마포어(Semaphore)는 시스템 범위에 걸쳐있고 파일시스템상의 파일 형태로 존재하는 반면 뮤텍스(Mutex)는 프로세스 범위를 가지며 프로세스(Process)가 종료될 때 자동으로 Clean up된다.
- 가장 큰 차이점은 관리하는 동기화 대상의 개수이다. 뮤텍스(Mutex)는 동기화 대상이 오직 하나뿐일 때, 세마포어(Semaphore)는 동기화 대상이 하나 이상일 때 사용한다.



## 참고
---
- [나무위키: 세마포어](https://namu.wiki/w/%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4)
- [나무위키: 뮤텍스](https://namu.wiki/w/%EB%AE%A4%ED%85%8D%EC%8A%A4)
- [세마포어와 뮤텍스](https://velog.io/@conatuseus/OS-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4%EC%99%80-%EB%AE%A4%ED%85%8D%EC%8A%A4)
- [세마포어 (SEMAPHORE) 개념과 예제(SEMGET,SEMCTL,SEMOP)](https://reakwon.tistory.com/95)
